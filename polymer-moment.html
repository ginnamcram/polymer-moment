<link rel="import" href="bower_components/polymer/polymer.html">
<script src="bower_components/moment/min/moment-with-locales.min.js"></script>
<dom-module id="polymer-moment">
  <template>
    <span>{{moment}}</span>
  </template>
  <script>
  	/** Moment extension **/
  	(function(moment){
  		'use strict';
  		moment.worker = {
	  		delay: 60000, //1min
	  		start: function(){
	  			if(this._timer) return;
	  			this._timer = setInterval(function(){
	  				var list = document.getElementsByTagName('polymer-moment');
	  				for (var i = 0; i < list.length; i++) {
	  					//update only if no format available
	  					if( !list[i].format )
	  						list[i].update();
	  				};
	  			}, this.delay);
	  		},
	  		stop: function(){
	  			clearInterval(this._timer);
	  			this._timer = false;
	  		}
	  	};
  	})(moment);

	Polymer({
		is: "polymer-moment",
		properties: {
			moment: {
				type: String,
				value: '',
      			notify: true
			},
			value: {
				type: String,
      			notify: false
			},
			inputFormat: {
				type: String,
				value: '',
      			notify: false
			},
			format: {
				type: String,
      			notify: false
			}
  		},
		ready: function(){
			//start worker
			moment.worker.start();

			this._moment = null;
			if(typeof(this.inputFormat) == 'string')	this._moment = moment(this.value,this.inputFormat);
			else										this._moment = moment(this.value);

			this.update();
		},
		update:function(){
			if(typeof(this.format) == 'string')	this.moment = this._moment.format(this.format);
			else 								this.moment = this._moment.fromNow();
		}
	});
  </script>

</dom-module>